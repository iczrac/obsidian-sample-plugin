import { Modal, Setting, moment } from 'obsidian';
import { BaziService } from '../services/BaziService';
/**
 * 日期选择模态框
 */
export class DatePickerModal extends Modal {
    constructor(app, onSubmit) {
        super(app);
        this.hour = 0;
        this.defaultGender = '1'; // 默认为男性
        this.baziSect = '2'; // 默认为流派2
        this.date = moment();
        this.onSubmit = onSubmit;
        // 尝试从插件设置中获取默认性别和流派
        try {
            // @ts-ignore - 忽略类型检查
            const plugin = app.plugins.plugins["bazi-obsidian"];
            if (plugin && plugin.settings) {
                this.defaultGender = plugin.settings.defaultGender || '1';
                this.baziSect = plugin.settings.baziSect || '2';
            }
        }
        catch (e) {
            console.log("无法获取插件设置，使用默认值");
        }
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl('h2', { text: '选择日期和时间' });
        // 日期选择
        new Setting(contentEl)
            .setName('日期')
            .setDesc('选择要转换为八字的日期')
            .addText(text => {
            text.setPlaceholder('YYYY-MM-DD')
                .setValue(this.date.format('YYYY-MM-DD'))
                .onChange(value => {
                const newDate = moment(value, 'YYYY-MM-DD', true);
                if (newDate.isValid()) {
                    this.date = newDate;
                }
            });
        });
        // 时间选择
        new Setting(contentEl)
            .setName('时辰')
            .setDesc('选择时辰（0-23点）')
            .addDropdown(dropdown => {
            // 添加24小时选项
            for (let i = 0; i < 24; i++) {
                dropdown.addOption(i.toString(), `${i}点 (${this.getChineseHour(i)}时)`);
            }
            dropdown.setValue(this.hour.toString())
                .onChange(value => {
                this.hour = parseInt(value);
            });
        });
        // 提交按钮
        new Setting(contentEl)
            .addButton(button => {
            button.setButtonText('生成八字')
                .setCta()
                .onClick(() => {
                try {
                    const year = this.date.year();
                    const month = this.date.month() + 1; // moment月份从0开始
                    const day = this.date.date();
                    // 获取八字信息
                    const baziInfo = BaziService.getBaziFromDate(year, month, day, this.hour, this.defaultGender, this.baziSect);
                    // 调用回调函数
                    this.onSubmit(baziInfo);
                    // 关闭模态框
                    this.close();
                }
                catch (error) {
                    console.error('生成八字信息出错:', error);
                    // 显示错误信息
                    const errorDiv = contentEl.createDiv();
                    errorDiv.setText(`错误: ${error.message}`);
                    errorDiv.addClass('bazi-error');
                }
            });
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
    /**
     * 获取中文时辰名称
     * @param hour 小时（0-23）
     * @returns 中文时辰名称
     */
    getChineseHour(hour) {
        const chineseHours = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        // 将24小时制转换为12时辰
        // 23:00-00:59 = 子时
        // 01:00-02:59 = 丑时
        // ...
        // 21:00-22:59 = 亥时
        const index = Math.floor((hour + 1) % 24 / 2);
        return chineseHours[index];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZVBpY2tlck1vZGFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRGF0ZVBpY2tlck1vZGFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBTyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN2RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFdEQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZUFBZ0IsU0FBUSxLQUFLO0lBT3hDLFlBQVksR0FBUSxFQUFFLFFBQWlDO1FBQ3JELEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQU5MLFNBQUksR0FBVyxDQUFDLENBQUM7UUFFakIsa0JBQWEsR0FBVyxHQUFHLENBQUMsQ0FBQyxRQUFRO1FBQ3JDLGFBQVEsR0FBVyxHQUFHLENBQUMsQ0FBQyxTQUFTO1FBSXZDLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFFekIsb0JBQW9CO1FBQ3BCLElBQUk7WUFDRixzQkFBc0I7WUFDdEIsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDcEQsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLFFBQVEsRUFBRTtnQkFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLGFBQWEsSUFBSSxHQUFHLENBQUM7Z0JBQzFELElBQUksQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDO2FBQ2pEO1NBQ0Y7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUMvQjtJQUNILENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElB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QU8sRUFBRSxDQUFDLENBQUM7b0JBQ3pDLFFBQVEsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7aUJBQ2pDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxPQUFPO1FBQ0wsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztRQUMzQixTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxjQUFjLENBQUMsSUFBWTtRQUNqQyxNQUFNLFlBQVksR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbEYsZ0JBQWdCO1FBQ2hCLG1CQUFtQjtRQUNuQixtQkFBbUI7UUFDbkIsTUFBTTtRQUNOLG1CQUFtQjtRQUNuQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5QyxPQUFPLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIE1vZGFsLCBTZXR0aW5nLCBtb21lbnQgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBCYXppU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL0JhemlTZXJ2aWNlJztcblxuLyoqXG4gKiDml6XmnJ/pgInmi6nmqKHmgIHmoYZcbiAqL1xuZXhwb3J0IGNsYXNzIERhdGVQaWNrZXJNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgcHJpdmF0ZSBkYXRlOiBtb21lbnQuTW9tZW50O1xuICBwcml2YXRlIGhvdXI6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgb25TdWJtaXQ6IChiYXppSW5mbzogYW55KSA9PiB2b2lkO1xuICBwcml2YXRlIGRlZmF1bHRHZW5kZXI6IHN0cmluZyA9ICcxJzsgLy8g6buY6K6k5Li655S35oCnXG4gIHByaXZhdGUgYmF6aVNlY3Q6IHN0cmluZyA9ICcyJzsgLy8g6buY6K6k5Li65rWB5rS+MlxuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblN1Ym1pdDogKGJhemlJbmZvOiBhbnkpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuZGF0ZSA9IG1vbWVudCgpO1xuICAgIHRoaXMub25TdWJtaXQgPSBvblN1Ym1pdDtcblxuICAgIC8vIOWwneivleS7juaPkuS7tuiuvue9ruS4reiOt+WPlum7mOiupOaAp+WIq+WSjOa1gea0vlxuICAgIHRyeSB7XG4gICAgICAvLyBAdHMtaWdub3JlIC0g5b+955Wl57G75Z6L5qOA5p+lXG4gICAgICBjb25zdCBwbHVnaW4gPSBhcHAucGx1Z2lucy5wbHVnaW5zW1wiYmF6aS1vYnNpZGlhblwiXTtcbiAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLnNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuZGVmYXVsdEdlbmRlciA9IHBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0R2VuZGVyIHx8ICcxJztcbiAgICAgICAgdGhpcy5iYXppU2VjdCA9IHBsdWdpbi5zZXR0aW5ncy5iYXppU2VjdCB8fCAnMic7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5sb2coXCLml6Dms5Xojrflj5bmj5Lku7borr7nva7vvIzkvb/nlKjpu5jorqTlgLxcIik7XG4gICAgfVxuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuXG4gICAgY29udGVudEVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ+mAieaLqeaXpeacn+WSjOaXtumXtCcgfSk7XG5cbiAgICAvLyDml6XmnJ/pgInmi6lcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuc2V0TmFtZSgn5pel5pyfJylcbiAgICAgIC5zZXREZXNjKCfpgInmi6nopoHovazmjaLkuLrlhavlrZfnmoTml6XmnJ8nKVxuICAgICAgLmFkZFRleHQodGV4dCA9PiB7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ1lZWVktTU0tREQnKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLmRhdGUuZm9ybWF0KCdZWVlZLU1NLUREJykpXG4gICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0RhdGUgPSBtb21lbnQodmFsdWUsICdZWVlZLU1NLUREJywgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAobmV3RGF0ZS5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgICAgdGhpcy5kYXRlID0gbmV3RGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgLy8g5pe26Ze06YCJ5oupXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ+aXtui+sCcpXG4gICAgICAuc2V0RGVzYygn6YCJ5oup5pe26L6w77yIMC0yM+eCue+8iScpXG4gICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4ge1xuICAgICAgICAvLyDmt7vliqAyNOWwj+aXtumAiemhuVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI0OyBpKyspIHtcbiAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oaS50b1N0cmluZygpLCBgJHtpfeeCuSAoJHt0aGlzLmdldENoaW5lc2VIb3VyKGkpfeaXtilgKTtcbiAgICAgICAgfVxuICAgICAgICBkcm9wZG93bi5zZXRWYWx1ZSh0aGlzLmhvdXIudG9TdHJpbmcoKSlcbiAgICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy5ob3VyID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyDmj5DkuqTmjInpkq5cbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XG4gICAgICAgIGJ1dHRvbi5zZXRCdXR0b25UZXh0KCfnlJ/miJDlhavlrZcnKVxuICAgICAgICAgIC5zZXRDdGEoKVxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IHllYXIgPSB0aGlzLmRhdGUueWVhcigpO1xuICAgICAgICAgICAgICBjb25zdCBtb250aCA9IHRoaXMuZGF0ZS5tb250aCgpICsgMTsgLy8gbW9tZW505pyI5Lu95LuOMOW8gOWni1xuICAgICAgICAgICAgICBjb25zdCBkYXkgPSB0aGlzLmRhdGUuZGF0ZSgpO1xuXG4gICAgICAgICAgICAgIC8vIOiOt+WPluWFq+Wtl+S/oeaBr1xuICAgICAgICAgICAgICBjb25zdCBiYXppSW5mbyA9IEJhemlTZXJ2aWNlLmdldEJhemlGcm9tRGF0ZSh5ZWFyLCBtb250aCwgZGF5LCB0aGlzLmhvdXIsIHRoaXMuZGVmYXVsdEdlbmRlciwgdGhpcy5iYXppU2VjdCk7XG5cbiAgICAgICAgICAgICAgLy8g6LCD55So5Zue6LCD5Ye95pWwXG4gICAgICAgICAgICAgIHRoaXMub25TdWJtaXQoYmF6aUluZm8pO1xuXG4gICAgICAgICAgICAgIC8vIOWFs+mXreaooeaAgeahhlxuICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfnlJ/miJDlhavlrZfkv6Hmga/lh7rplJk6JywgZXJyb3IpO1xuICAgICAgICAgICAgICAvLyDmmL7npLrplJnor6/kv6Hmga9cbiAgICAgICAgICAgICAgY29uc3QgZXJyb3JEaXYgPSBjb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgIGVycm9yRGl2LnNldFRleHQoYOmUmeivrzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICBlcnJvckRpdi5hZGRDbGFzcygnYmF6aS1lcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOiOt+WPluS4reaWh+aXtui+sOWQjeensFxuICAgKiBAcGFyYW0gaG91ciDlsI/ml7bvvIgwLTIz77yJXG4gICAqIEByZXR1cm5zIOS4reaWh+aXtui+sOWQjeensFxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDaGluZXNlSG91cihob3VyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNoaW5lc2VIb3VycyA9IFsn5a2QJywgJ+S4kScsICflr4UnLCAn5Y2vJywgJ+i+sCcsICflt7MnLCAn5Y2IJywgJ+acqicsICfnlLMnLCAn6YWJJywgJ+aIjCcsICfkuqUnXTtcbiAgICAvLyDlsIYyNOWwj+aXtuWItui9rOaNouS4ujEy5pe26L6wXG4gICAgLy8gMjM6MDAtMDA6NTkgPSDlrZDml7ZcbiAgICAvLyAwMTowMC0wMjo1OSA9IOS4keaXtlxuICAgIC8vIC4uLlxuICAgIC8vIDIxOjAwLTIyOjU5ID0g5Lql5pe2XG4gICAgY29uc3QgaW5kZXggPSBNYXRoLmZsb29yKChob3VyICsgMSkgJSAyNCAvIDIpO1xuICAgIHJldHVybiBjaGluZXNlSG91cnNbaW5kZXhdO1xuICB9XG59XG4iXX0=