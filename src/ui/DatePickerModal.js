import { Modal, Setting, moment } from 'obsidian';
import { BaziService } from '../services/BaziService';
/**
 * 日期选择模态框
 */
export class DatePickerModal extends Modal {
    constructor(app, onSubmit) {
        super(app);
        this.hour = 0;
        this.gender = ''; // 性别，默认为空
        this.baziSect = '2'; // 默认为流派2
        this.date = moment();
        this.onSubmit = onSubmit;
        // 尝试从插件设置中获取流派
        try {
            // @ts-ignore - 忽略类型检查
            const plugin = app.plugins.plugins["bazi-obsidian"];
            if (plugin && plugin.settings) {
                this.baziSect = plugin.settings.baziSect || '2';
            }
        }
        catch (e) {
            console.log("无法获取插件设置，使用默认值");
        }
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.createEl('h2', { text: '选择日期和时间' });
        // 日期选择
        new Setting(contentEl)
            .setName('日期')
            .setDesc('选择要转换为八字的日期')
            .addText(text => {
            text.setPlaceholder('YYYY-MM-DD')
                .setValue(this.date.format('YYYY-MM-DD'))
                .onChange(value => {
                const newDate = moment(value, 'YYYY-MM-DD', true);
                if (newDate.isValid()) {
                    this.date = newDate;
                }
            });
        });
        // 时间选择
        new Setting(contentEl)
            .setName('时辰')
            .setDesc('选择时辰（0-23点）')
            .addDropdown(dropdown => {
            // 添加24小时选项
            for (let i = 0; i < 24; i++) {
                dropdown.addOption(i.toString(), `${i}点 (${this.getChineseHour(i)}时)`);
            }
            dropdown.setValue(this.hour.toString())
                .onChange(value => {
                this.hour = parseInt(value);
            });
        });
        // 性别选择
        new Setting(contentEl)
            .setName('性别')
            .setDesc('选择性别，用于大运计算')
            .addDropdown(dropdown => {
            dropdown
                .addOption('', '请选择')
                .addOption('1', '男')
                .addOption('0', '女')
                .setValue(this.gender)
                .onChange(value => {
                this.gender = value;
            });
        });
        // 提交按钮
        new Setting(contentEl)
            .addButton(button => {
            button.setButtonText('生成八字')
                .setCta()
                .onClick(() => {
                try {
                    const year = this.date.year();
                    const month = this.date.month() + 1; // moment月份从0开始
                    const day = this.date.date();
                    // 获取八字信息
                    const baziInfo = BaziService.getBaziFromDate(year, month, day, this.hour, this.gender, this.baziSect);
                    // 确保性别信息被传递给回调函数
                    baziInfo.gender = this.gender;
                    // 调用回调函数
                    this.onSubmit(baziInfo);
                    // 关闭模态框
                    this.close();
                }
                catch (error) {
                    console.error('生成八字信息出错:', error);
                    // 显示错误信息
                    const errorDiv = contentEl.createDiv();
                    errorDiv.setText(`错误: ${error.message}`);
                    errorDiv.addClass('bazi-error');
                }
            });
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
    /**
     * 获取中文时辰名称
     * @param hour 小时（0-23）
     * @returns 中文时辰名称
     */
    getChineseHour(hour) {
        const chineseHours = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        // 将24小时制转换为12时辰
        // 23:00-00:59 = 子时
        // 01:00-02:59 = 丑时
        // ...
        // 21:00-22:59 = 亥时
        const index = Math.floor((hour + 1) % 24 / 2);
        return chineseHours[index];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZVBpY2tlck1vZGFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRGF0ZVBpY2tlck1vZGFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBTyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN2RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFdEQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZUFBZ0IsU0FBUSxLQUFLO0lBT3hDLFlBQVksR0FBUSxFQUFFLFFBQWlDO1FBQ3JELEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQU5MLFNBQUksR0FBVyxDQUFDLENBQUM7UUFFakIsV0FBTSxHQUFXLEVBQUUsQ0FBQyxDQUFDLFVBQVU7UUFDL0IsYUFBUSxHQUFXLEdBQUcsQ0FBQyxDQUFDLFNBQVM7UUFJdkMsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUV6QixlQUFlO1FBQ2YsSUFBSTtZQUNGLHNCQUFzQjtZQUN0QixNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNwRCxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsUUFBUSxFQUFFO2dCQUM3QixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQzthQUNqRDtTQUNGO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDL0I7SUFDSCxDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFFM0IsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENB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LEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzlDLE9BQU8sWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcCwgTW9kYWwsIFNldHRpbmcsIG1vbWVudCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEJhemlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvQmF6aVNlcnZpY2UnO1xuXG4vKipcbiAqIOaXpeacn+mAieaLqeaooeaAgeahhlxuICovXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlck1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIGRhdGU6IG1vbWVudC5Nb21lbnQ7XG4gIHByaXZhdGUgaG91cjogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBvblN1Ym1pdDogKGJhemlJbmZvOiBhbnkpID0+IHZvaWQ7XG4gIHByaXZhdGUgZ2VuZGVyOiBzdHJpbmcgPSAnJzsgLy8g5oCn5Yir77yM6buY6K6k5Li656m6XG4gIHByaXZhdGUgYmF6aVNlY3Q6IHN0cmluZyA9ICcyJzsgLy8g6buY6K6k5Li65rWB5rS+MlxuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblN1Ym1pdDogKGJhemlJbmZvOiBhbnkpID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuZGF0ZSA9IG1vbWVudCgpO1xuICAgIHRoaXMub25TdWJtaXQgPSBvblN1Ym1pdDtcblxuICAgIC8vIOWwneivleS7juaPkuS7tuiuvue9ruS4reiOt+WPlua1gea0vlxuICAgIHRyeSB7XG4gICAgICAvLyBAdHMtaWdub3JlIC0g5b+955Wl57G75Z6L5qOA5p+lXG4gICAgICBjb25zdCBwbHVnaW4gPSBhcHAucGx1Z2lucy5wbHVnaW5zW1wiYmF6aS1vYnNpZGlhblwiXTtcbiAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLnNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuYmF6aVNlY3QgPSBwbHVnaW4uc2V0dGluZ3MuYmF6aVNlY3QgfHwgJzInO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwi5peg5rOV6I635Y+W5o+S5Lu26K6+572u77yM5L2/55So6buY6K6k5YC8XCIpO1xuICAgIH1cbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcblxuICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICfpgInmi6nml6XmnJ/lkozml7bpl7QnIH0pO1xuXG4gICAgLy8g5pel5pyf6YCJ5oupXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ+aXpeacnycpXG4gICAgICAuc2V0RGVzYygn6YCJ5oup6KaB6L2s5o2i5Li65YWr5a2X55qE5pel5pyfJylcbiAgICAgIC5hZGRUZXh0KHRleHQgPT4ge1xuICAgICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKCdZWVlZLU1NLUREJylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5kYXRlLmZvcm1hdCgnWVlZWS1NTS1ERCcpKVxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuZXdEYXRlID0gbW9tZW50KHZhbHVlLCAnWVlZWS1NTS1ERCcsIHRydWUpO1xuICAgICAgICAgICAgaWYgKG5ld0RhdGUuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgIHRoaXMuZGF0ZSA9IG5ld0RhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIC8vIOaXtumXtOmAieaLqVxuICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5zZXROYW1lKCfml7bovrAnKVxuICAgICAgLnNldERlc2MoJ+mAieaLqeaXtui+sO+8iDAtMjPngrnvvIknKVxuICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IHtcbiAgICAgICAgLy8g5re75YqgMjTlsI/ml7bpgInpoblcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNDsgaSsrKSB7XG4gICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKGkudG9TdHJpbmcoKSwgYCR7aX3ngrkgKCR7dGhpcy5nZXRDaGluZXNlSG91cihpKX3ml7YpYCk7XG4gICAgICAgIH1cbiAgICAgICAgZHJvcGRvd24uc2V0VmFsdWUodGhpcy5ob3VyLnRvU3RyaW5nKCkpXG4gICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIHRoaXMuaG91ciA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgLy8g5oCn5Yir6YCJ5oupXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ+aAp+WIqycpXG4gICAgICAuc2V0RGVzYygn6YCJ5oup5oCn5Yir77yM55So5LqO5aSn6L+Q6K6h566XJylcbiAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICAgIGRyb3Bkb3duXG4gICAgICAgICAgLmFkZE9wdGlvbignJywgJ+ivt+mAieaLqScpXG4gICAgICAgICAgLmFkZE9wdGlvbignMScsICfnlLcnKVxuICAgICAgICAgIC5hZGRPcHRpb24oJzAnLCAn5aWzJylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5nZW5kZXIpXG4gICAgICAgICAgLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ2VuZGVyID0gdmFsdWU7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIC8vIOaPkOS6pOaMiemSrlxuICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IHtcbiAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoJ+eUn+aIkOWFq+WtlycpXG4gICAgICAgICAgLnNldEN0YSgpXG4gICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgeWVhciA9IHRoaXMuZGF0ZS55ZWFyKCk7XG4gICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gdGhpcy5kYXRlLm1vbnRoKCkgKyAxOyAvLyBtb21lbnTmnIjku73ku44w5byA5aeLXG4gICAgICAgICAgICAgIGNvbnN0IGRheSA9IHRoaXMuZGF0ZS5kYXRlKCk7XG5cbiAgICAgICAgICAgICAgLy8g6I635Y+W5YWr5a2X5L+h5oGvXG4gICAgICAgICAgICAgIGNvbnN0IGJhemlJbmZvID0gQmF6aVNlcnZpY2UuZ2V0QmF6aUZyb21EYXRlKHllYXIsIG1vbnRoLCBkYXksIHRoaXMuaG91ciwgdGhpcy5nZW5kZXIsIHRoaXMuYmF6aVNlY3QpO1xuXG4gICAgICAgICAgICAgIC8vIOehruS/neaAp+WIq+S/oeaBr+iiq+S8oOmAkue7meWbnuiwg+WHveaVsFxuICAgICAgICAgICAgICBiYXppSW5mby5nZW5kZXIgPSB0aGlzLmdlbmRlcjtcblxuICAgICAgICAgICAgICAvLyDosIPnlKjlm57osIPlh73mlbBcbiAgICAgICAgICAgICAgdGhpcy5vblN1Ym1pdChiYXppSW5mbyk7XG5cbiAgICAgICAgICAgICAgLy8g5YWz6Zet5qih5oCB5qGGXG4gICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+eUn+aIkOWFq+Wtl+S/oeaBr+WHuumUmTonLCBlcnJvcik7XG4gICAgICAgICAgICAgIC8vIOaYvuekuumUmeivr+S/oeaBr1xuICAgICAgICAgICAgICBjb25zdCBlcnJvckRpdiA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgICAgICAgZXJyb3JEaXYuc2V0VGV4dChg6ZSZ6K+vOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgIGVycm9yRGl2LmFkZENsYXNzKCdiYXppLWVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG9uQ2xvc2UoKSB7XG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgY29udGVudEVsLmVtcHR5KCk7XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5Lit5paH5pe26L6w5ZCN56ewXG4gICAqIEBwYXJhbSBob3VyIOWwj+aXtu+8iDAtMjPvvIlcbiAgICogQHJldHVybnMg5Lit5paH5pe26L6w5ZCN56ewXG4gICAqL1xuICBwcml2YXRlIGdldENoaW5lc2VIb3VyKGhvdXI6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3QgY2hpbmVzZUhvdXJzID0gWyflrZAnLCAn5LiRJywgJ+WvhScsICflja8nLCAn6L6wJywgJ+W3sycsICfljYgnLCAn5pyqJywgJ+eUsycsICfphYknLCAn5oiMJywgJ+S6pSddO1xuICAgIC8vIOWwhjI05bCP5pe25Yi26L2s5o2i5Li6MTLml7bovrBcbiAgICAvLyAyMzowMC0wMDo1OSA9IOWtkOaXtlxuICAgIC8vIDAxOjAwLTAyOjU5ID0g5LiR5pe2XG4gICAgLy8gLi4uXG4gICAgLy8gMjE6MDAtMjI6NTkgPSDkuqXml7ZcbiAgICBjb25zdCBpbmRleCA9IE1hdGguZmxvb3IoKGhvdXIgKyAxKSAlIDI0IC8gMik7XG4gICAgcmV0dXJuIGNoaW5lc2VIb3Vyc1tpbmRleF07XG4gIH1cbn1cbiJdfQ==