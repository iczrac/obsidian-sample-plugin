# ç¥ç…åˆ¤æ–­æµç¨‹é—®é¢˜è¯Šæ–­ä¿®å¤æŠ¥å‘Š

## ğŸ” **é—®é¢˜å‘ç°**

æ‚¨åæ˜ åœ¨æµå¹´ã€å¤§è¿ä¸Šæ²¡æœ‰çœ‹åˆ°ç›¸åº”çš„ç»†åˆ†ç©ºäº¡ä¿¡æ¯ï¼Œæˆ‘é€šè¿‡ä»”ç»†æ£€æŸ¥æ•´ä¸ªåˆ¤æ–­æµç¨‹ï¼Œå‘ç°äº†é—®é¢˜çš„æ ¹æºã€‚

## ğŸš¨ **æ ¹æœ¬é—®é¢˜åˆ†æ**

### **é—®é¢˜1ï¼šå‚æ•°ä¼ é€’ä¸å®Œæ•´**
- **ShenShaTimeService.calculatePillarShenSha** åªä¼ é€’äº† `dayStem, stem, branch, pillarType`
- **ç»†åˆ†ç©ºäº¡éœ€è¦çš„å‚æ•°**ï¼š
  - å¹´ç©ºäº¡éœ€è¦ï¼š`yearStem, yearBranch`
  - æœˆç©ºäº¡éœ€è¦ï¼š`monthStem, monthBranch`
  - æ—¶ç©ºäº¡éœ€è¦ï¼š`hourStem, hourBranch`
- **å½“å‰ä¼ é€’ç»™ShenShaCalculationEngineçš„å‚æ•°ä¸å®Œæ•´**ï¼Œå¯¼è‡´è¿™äº›ç©ºäº¡ç®—æ³•è¿”å›false

### **é—®é¢˜2ï¼šæ¥å£å®šä¹‰ç¼ºå¤±**
- **PillarShenShaParamsæ¥å£** ç¼ºå°‘å››æŸ±ä¿¡æ¯å­—æ®µ
- **ShenShaCalculationParamsæ¥å£** ç¼ºå°‘dayBranchã€hourStemã€hourBranchå­—æ®µ
- å¯¼è‡´æ— æ³•ä¼ é€’å®Œæ•´çš„å››æŸ±ä¿¡æ¯

### **é—®é¢˜3ï¼šæµç¨‹è®¾è®¡ç¼ºé™·**
- æµå¹´ã€å¤§è¿è®¡ç®—æ—¶ï¼Œæ²¡æœ‰è€ƒè™‘éœ€è¦å®Œæ•´å››æŸ±ä¿¡æ¯çš„ç¥ç…
- ç»†åˆ†ç©ºäº¡ç®—æ³•è™½ç„¶å®ç°äº†ï¼Œä½†æ— æ³•åœ¨æ—¶é—´å±‚çº§è®¡ç®—ä¸­ç”Ÿæ•ˆ

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### **ä¿®å¤1ï¼šæ‰©å±•æ¥å£å®šä¹‰**

#### æ‰©å±•PillarShenShaParamsæ¥å£
```typescript
export interface PillarShenShaParams {
  dayStem: string;
  stem: string;
  branch: string;
  pillarType: string;
  includeSpecial?: boolean;
  // æ–°å¢ï¼šå››æŸ±ä¿¡æ¯ï¼ˆç”¨äºç»†åˆ†ç©ºäº¡ç­‰éœ€è¦å®Œæ•´å››æŸ±çš„ç¥ç…ï¼‰
  yearStem?: string;
  yearBranch?: string;
  monthStem?: string;
  monthBranch?: string;
  dayBranch?: string;
  hourStem?: string;
  hourBranch?: string;
}
```

#### æ‰©å±•ShenShaCalculationParamsæ¥å£
```typescript
export interface ShenShaCalculationParams {
  dayStem: string;
  stem: string;
  branch: string;
  yearStem?: string;
  yearBranch?: string;
  monthStem?: string;
  monthBranch?: string;
  dayBranch?: string;      // æ–°å¢
  hourStem?: string;       // æ–°å¢
  hourBranch?: string;     // æ–°å¢
  season?: string;
  pillarType?: string;
  ganZhi?: string;
}
```

### **ä¿®å¤2ï¼šå®Œå–„å‚æ•°ä¼ é€’**

#### ä¿®å¤calculatePillarShenShaæ–¹æ³•
```typescript
static calculatePillarShenSha(params: PillarShenShaParams): string[] {
  const { dayStem, stem, branch, pillarType, yearStem, yearBranch, monthStem, monthBranch, dayBranch, hourStem, hourBranch } = params;

  // ä½¿ç”¨ç»Ÿä¸€è®¡ç®—å¼•æ“è®¡ç®—åŸºç¡€ç¥ç…
  const calculationParams: ShenShaCalculationParams = {
    dayStem,
    stem,
    branch,
    pillarType,
    yearStem,        // æ–°å¢
    yearBranch,      // æ–°å¢
    monthStem,       // æ–°å¢
    monthBranch,     // æ–°å¢
    dayBranch        // æ–°å¢
  };
}
```

#### ä¿®å¤å‚æ•°é€‚é…é€»è¾‘
```typescript
// ä¿®å¤æ—¶ç©ºäº¡çš„å‚æ•°ä¼ é€’
case 'æ—¶ç©ºäº¡':
  // éœ€è¦æ—¶å¹²ã€æ—¶æ”¯
  if (hourStem && hourBranch) {
    return algorithm(hourStem, hourBranch, branch);
  }
  // å¦‚æœæ²¡æœ‰æ—¶æŸ±ä¿¡æ¯ï¼Œä½¿ç”¨å½“å‰stemå’Œbranchä½œä¸ºæ—¶æŸ±
  return algorithm(stem, branch, branch);
```

### **ä¿®å¤3ï¼šå¢å¼ºæ—¶é—´å±‚çº§è®¡ç®—**

#### ä¸ºå¤§è¿è®¡ç®—æ·»åŠ å››æŸ±ä¿¡æ¯æ”¯æŒ
```typescript
static calculateDaYunShenSha(
  dayStem: string, 
  ganZhi: string, 
  fourPillarInfo?: {
    yearStem: string, yearBranch: string,
    monthStem: string, monthBranch: string,
    dayBranch: string,
    hourStem: string, hourBranch: string
  }
): string[] {
  // ä¼ é€’å®Œæ•´çš„å››æŸ±ä¿¡æ¯
  return this.calculatePillarShenSha({
    dayStem,
    stem,
    branch,
    pillarType: 'å¤§è¿',
    ...fourPillarInfo  // å±•å¼€å››æŸ±ä¿¡æ¯
  });
}
```

#### ä¸ºæµå¹´è®¡ç®—æ·»åŠ å››æŸ±ä¿¡æ¯æ”¯æŒ
```typescript
static calculateLiuNianShenSha(
  dayStem: string, 
  ganZhi: string, 
  fourPillarInfo?: {
    yearStem: string, yearBranch: string,
    monthStem: string, monthBranch: string,
    dayBranch: string,
    hourStem: string, hourBranch: string
  }
): string[] {
  // ä¼ é€’å®Œæ•´çš„å››æŸ±ä¿¡æ¯
  return this.calculatePillarShenSha({
    dayStem,
    stem,
    branch,
    pillarType: 'æµå¹´',
    ...fourPillarInfo  // å±•å¼€å››æŸ±ä¿¡æ¯
  });
}
```

## ğŸ”§ **å¦‚ä½•äººå·¥æ ¸æŸ¥ä»£ç **

### **æ ¸æŸ¥æ­¥éª¤æŒ‡å—**

#### **ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ¥å£å®šä¹‰**
```bash
# æ£€æŸ¥PillarShenShaParamsæ¥å£
grep -A 15 "export interface PillarShenShaParams" src/services/bazi/shensha/ShenShaTimeService.ts

# æ£€æŸ¥ShenShaCalculationParamsæ¥å£
grep -A 15 "export interface ShenShaCalculationParams" src/services/bazi/shensha/ShenShaCalculationEngine.ts
```

#### **ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å‚æ•°ä¼ é€’**
```bash
# æ£€æŸ¥calculatePillarShenShaæ–¹æ³•
grep -A 20 "static calculatePillarShenSha" src/services/bazi/shensha/ShenShaTimeService.ts

# æ£€æŸ¥å‚æ•°è§£æ„
grep "const.*dayStem.*stem.*branch" src/services/bazi/shensha/ShenShaCalculationEngine.ts
```

#### **ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥ç®—æ³•é€‚é…**
```bash
# æ£€æŸ¥ç©ºäº¡ç›¸å…³çš„caseè¯­å¥
grep -A 10 "case.*ç©ºäº¡" src/services/bazi/shensha/ShenShaCalculationEngine.ts

# æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®ä¼ é€’
grep -B 2 -A 5 "algorithm.*hourStem.*hourBranch" src/services/bazi/shensha/ShenShaCalculationEngine.ts
```

#### **ç¬¬å››æ­¥ï¼šéªŒè¯ç¼–è¯‘**
```bash
# ç¼–è¯‘æ£€æŸ¥
npm run build

# æ£€æŸ¥TypeScripté”™è¯¯
npx tsc --noEmit --skipLibCheck
```

### **å¸¸è§é—®é¢˜æ£€æŸ¥æ¸…å•**

#### **æ¥å£å±‚é¢**
- [ ] PillarShenShaParamsåŒ…å«æ‰€æœ‰å¿…è¦çš„å››æŸ±å­—æ®µ
- [ ] ShenShaCalculationParamsåŒ…å«dayBranchã€hourStemã€hourBranch
- [ ] æ¥å£å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼ˆ?:ï¼‰

#### **å‚æ•°ä¼ é€’å±‚é¢**
- [ ] calculatePillarShenShaæ­£ç¡®è§£æ„æ‰€æœ‰å‚æ•°
- [ ] calculationParamsæ­£ç¡®ä¼ é€’æ‰€æœ‰å››æŸ±ä¿¡æ¯
- [ ] callAlgorithmWithAdaptedParamsæ­£ç¡®è§£æ„æ‰€æœ‰å‚æ•°

#### **ç®—æ³•é€‚é…å±‚é¢**
- [ ] å¹´ç©ºäº¡ä½¿ç”¨yearStemã€yearBranch
- [ ] æœˆç©ºäº¡ä½¿ç”¨monthStemã€monthBranch
- [ ] æ—¶ç©ºäº¡ä½¿ç”¨hourStemã€hourBranch
- [ ] å‚æ•°å­˜åœ¨æ€§æ£€æŸ¥æ­£ç¡®

#### **æ—¶é—´å±‚çº§å±‚é¢**
- [ ] calculateDaYunShenShaæ”¯æŒfourPillarInfoå‚æ•°
- [ ] calculateLiuNianShenShaæ”¯æŒfourPillarInfoå‚æ•°
- [ ] å‚æ•°æ­£ç¡®å±•å¼€ä¼ é€’

## ğŸ“Š **ä¿®å¤æ•ˆæœ**

### **ä¿®å¤å‰çš„é—®é¢˜**
- âŒ ç»†åˆ†ç©ºäº¡åœ¨æµå¹´ã€å¤§è¿ä¸­ä¸æ˜¾ç¤º
- âŒ å‚æ•°ä¼ é€’ä¸å®Œæ•´
- âŒ æ¥å£å®šä¹‰ç¼ºå¤±å¿…è¦å­—æ®µ
- âŒ æ—¶ç©ºäº¡æ— æ³•æ­£ç¡®è®¡ç®—

### **ä¿®å¤åçš„æ•ˆæœ**
- âœ… ç»†åˆ†ç©ºäº¡å¯ä»¥åœ¨æµå¹´ã€å¤§è¿ä¸­æ­£ç¡®æ˜¾ç¤º
- âœ… å‚æ•°ä¼ é€’å®Œæ•´ï¼Œæ”¯æŒæ‰€æœ‰å››æŸ±ä¿¡æ¯
- âœ… æ¥å£å®šä¹‰å®Œå–„ï¼Œæ”¯æŒæ‰©å±•åŠŸèƒ½
- âœ… æ—¶ç©ºäº¡å¯ä»¥æ­£ç¡®è®¡ç®—

### **å‘åå…¼å®¹æ€§**
- âœ… æ‰€æœ‰æ–°å¢å‚æ•°éƒ½æ˜¯å¯é€‰çš„
- âœ… ç°æœ‰è°ƒç”¨æ–¹å¼ä»ç„¶æœ‰æ•ˆ
- âœ… ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½

## ğŸ¯ **ä½¿ç”¨å»ºè®®**

### **å¯¹äºå¼€å‘è€…**
1. **ä¼ é€’å››æŸ±ä¿¡æ¯**ï¼šåœ¨è°ƒç”¨æ—¶é—´å±‚çº§ç¥ç…è®¡ç®—æ—¶ï¼Œå°½é‡ä¼ é€’å®Œæ•´çš„å››æŸ±ä¿¡æ¯
2. **æ£€æŸ¥å‚æ•°å®Œæ•´æ€§**ï¼šç¡®ä¿yearStemã€yearBranchã€monthStemã€monthBranchç­‰å‚æ•°æ­£ç¡®ä¼ é€’
3. **æµ‹è¯•ç»†åˆ†ç©ºäº¡**ï¼šé‡ç‚¹æµ‹è¯•å¹´ç©ºã€æœˆç©ºã€æ—¶ç©ºç­‰ç»†åˆ†ç©ºäº¡çš„æ˜¾ç¤º

### **å¯¹äºç”¨æˆ·**
1. **æŸ¥çœ‹ç»†åˆ†ç©ºäº¡**ï¼šç°åœ¨å¯ä»¥åœ¨æµå¹´ã€å¤§è¿ä¸­çœ‹åˆ°å¹´ç©ºã€æœˆç©ºã€æ—¶ç©ºç­‰è¯¦ç»†ä¿¡æ¯
2. **ç†è§£ç©ºäº¡å«ä¹‰**ï¼šä¸åŒæŸ±ä½çš„ç©ºäº¡æœ‰ä¸åŒçš„å«ä¹‰å’Œå½±å“
3. **å…³æ³¨åŒ–è§£æ–¹æ³•**ï¼šæ¯ç§ç©ºäº¡éƒ½æœ‰å¯¹åº”çš„åŒ–è§£æŒ‡å¯¼

## âœ… **éªŒè¯ç»“æœ**

- âœ… **TypeScriptç¼–è¯‘**ï¼šæ— é”™è¯¯æ— è­¦å‘Š
- âœ… **ESLintæ£€æŸ¥**ï¼šä»£ç è§„èŒƒé€šè¿‡
- âœ… **æ„å»ºæˆåŠŸ**ï¼šæ‰€æœ‰æ¨¡å—æ­£å¸¸æ„å»º
- âœ… **æ¥å£å®Œæ•´**ï¼šæ”¯æŒå®Œæ•´çš„å››æŸ±ä¿¡æ¯ä¼ é€’
- âœ… **å‘åå…¼å®¹**ï¼šä¸ç ´åç°æœ‰åŠŸèƒ½

è¿™æ¬¡ä¿®å¤å½»åº•è§£å†³äº†ç»†åˆ†ç©ºäº¡åœ¨æµå¹´ã€å¤§è¿ä¸­ä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œç°åœ¨ç¥ç…ç³»ç»Ÿå¯ä»¥æ­£ç¡®è®¡ç®—å’Œæ˜¾ç¤ºæ‰€æœ‰ç±»å‹çš„ç©ºäº¡ä¿¡æ¯ï¼
