# 八字扩展列功能说明

## 功能概述

新增的扩展列功能允许在八字代码块中通过 `extend` 参数控制表格的自动扩展行为，支持多种扩展模式。

## 扩展类型

### 1. 不自动扩展 (`none`)
```bazi
date: 1990-01-01 08:00
gender: 男
extend: none
```

### 2. 自动扩展到当前流时 (`auto_current`)
动态扩展到当前时间的流时层级，会自动更新到当前年月日时。
```bazi
date: 1990-01-01 08:00
gender: 男
extend: auto_current
```

### 3. 自动扩展到流日 (`auto_day`)
扩展到当前日期的流日层级。
```bazi
date: 1990-01-01 08:00
gender: 男
extend: auto_day
```

### 4. 自动扩展到流月 (`auto_month`)
扩展到当前月份的流月层级。
```bazi
date: 1990-01-01 08:00
gender: 男
extend: auto_month
```

### 5. 扩展胎元命宫身宫 (`special_palaces`)
扩展显示胎元、命宫、身宫三个特殊宫位。
```bazi
date: 1990-01-01 08:00
gender: 男
extend: special_palaces
```

### 6. 自定义扩展 (`custom`)
扩展到指定的目标时间。
```bazi
date: 1990-01-01 08:00
gender: 男
extend: custom
extendTarget: 2024-12-17 14:30
```

## 参数说明

### 完整参数
| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `extend` | string | 扩展类型 | `auto_current`, `auto_day`, `auto_month`, `special_palaces`, `custom`, `none` |
| `extendTarget` | string | 自定义目标时间（仅用于custom模式） | `2024-12-17 14:30` |
| `extendCount` | number | 扩展列数量（保留参数，暂未使用） | `3` |

### 简洁参数
| 参数 | 等效完整参数 | 说明 | 示例 |
|------|-------------|------|------|
| `ex` | `extend` | 扩展类型（简洁版） | `cur`, `day`, `month`, `palace`, `custom`, `no` |
| `to` | `extendTarget` | 目标时间（简洁版） | `2024-12-17 14:30` |
| `count` | `extendCount` | 扩展数量（简洁版） | `3` |

### 超简洁参数（单字母）
| 参数 | 等效完整参数 | 说明 | 示例 |
|------|-------------|------|------|
| `e` | `extend` | 扩展类型（单字母） | `1`, `2`, `3`, `4`, `5`, `0` |
| `t` | `extendTarget` | 目标时间（单字母） | `2024-12-17 14:30` |
| `c` | `extendCount` | 扩展数量（单字母） | `3` |

## 参数别名支持

### 扩展类型别名
| 功能 | 完整参数 | 简洁别名 | 单字母/数字 | 中文别名 |
|------|----------|----------|-------------|----------|
| 不扩展 | `none` | `no`, `n` | `0` | `无`, `不扩展` |
| 自动当前 | `auto_current` | `current`, `now`, `cur` | `1` | `当前`, `自动当前`, `现在` |
| 自动流日 | `auto_day` | `day` | `d`, `2` | `流日`, `自动流日`, `日` |
| 自动流月 | `auto_month` | `month` | `m`, `3` | `流月`, `自动流月`, `月` |
| 特殊宫位 | `special_palaces` | `palaces`, `palace` | `p`, `4` | `宫位`, `胎元命宫身宫`, `宫` |
| 自定义 | `custom` | - | `c`, `5` | `自定义` |

### 参数优先级
当同时使用多种参数名时，按以下优先级生效：
1. 完整参数（`extend`, `extendTarget`, `extendCount`）
2. 简洁参数（`ex`, `to`, `count`）
3. 单字母参数（`e`, `t`, `c`）

## 使用示例

### 完整参数示例

#### 示例1：查看当前运势
```bazi
bazi: 庚午 戊子 甲子 乙亥
gender: 男
extend: auto_current
```

#### 示例2：分析特殊宫位
```bazi
date: 1985-03-15 10:30
gender: 女
extend: special_palaces
```

#### 示例3：查看特定时间运势
```bazi
lunar: 1990-01-01 08:00
gender: 男
extend: custom
extendTarget: 2025-01-01 12:00
```

### 简洁参数示例

#### 示例4：使用简洁参数查看当前运势
```bazi
bazi: 庚午 戊子 甲子 乙亥
gender: 男
ex: cur
```

#### 示例5：使用简洁参数分析宫位
```bazi
date: 1985-03-15 10:30
gender: 女
ex: palace
```

#### 示例6：使用简洁参数自定义时间
```bazi
lunar: 1990-01-01 08:00
gender: 男
ex: custom
to: 2025-01-01 12:00
```

### 超简洁参数示例

#### 示例7：使用数字参数
```bazi
bazi: 庚午 戊子 甲子 乙亥
gender: 男
e: 1
```

#### 示例8：使用单字母参数
```bazi
date: 1985-03-15 10:30
gender: 女
e: p
```

#### 示例9：使用单字母自定义
```bazi
lunar: 1990-01-01 08:00
gender: 男
e: 5
t: 2025-01-01 12:00
```

### 中文参数示例

#### 示例10：使用中文参数
```bazi
bazi: 庚午 戊子 甲子 乙亥
gender: 男
extend: 当前
```

#### 示例11：混合使用
```bazi
date: 1985-03-15 10:30
gender: 女
ex: 宫位
```

## 技术实现

### 核心组件

1. **ExtendedColumnType 枚举**：定义扩展类型
2. **ExtendedColumnManager**：管理扩展列的计算和显示
3. **CodeBlockProcessor**：解析代码块参数
4. **InteractiveBaziView**：处理自动扩展逻辑

### 扩展流程

1. 代码块解析 → 识别 `extend` 参数
2. 参数传递 → 将扩展配置传递给 BaziInfo
3. 表格创建 → 创建基础四柱表格
4. 自动扩展 → 根据配置自动扩展相应列
5. 动态更新 → 支持时间动态更新（auto_current模式）

### 特殊宫位计算

- **胎元**：月干+5，月支+3
- **命宫**：时干+7，时支+1  
- **身宫**：月支+时支的数值相加

## 注意事项

1. 自动扩展功能仅在样式3（完整专业样式）中可用
2. `auto_current` 模式会动态更新到当前时间
3. 特殊宫位扩展不属于时间层级，不支持进一步交互
4. 自定义扩展需要提供有效的时间格式
5. 扩展列会自动计算十神、神煞、地势等信息

## 快速参考

### 最常用的简洁写法
```bazi
# 查看当前运势（最简）
bazi: 庚午 戊子 甲子 乙亥
gender: 男
e: 1

# 查看流日运势
date: 1990-01-01 08:00
gender: 女
e: 2

# 查看宫位信息
lunar: 1990-01-01 08:00
gender: 男
e: 4

# 自定义时间（最简）
bazi: 庚午 戊子 甲子 乙亥
gender: 女
e: 5
t: 2025-01-01 12:00
```

### 记忆口诀
- `e: 0` = 不扩展
- `e: 1` = 当前时间
- `e: 2` = 流日
- `e: 3` = 流月
- `e: 4` = 宫位
- `e: 5` = 自定义

## 兼容性

- 向后兼容：不使用 `extend` 参数的代码块保持原有行为
- 样式兼容：仅在样式3中启用，其他样式忽略扩展参数
- 参数兼容：支持多种参数格式和中文别名
- 优先级：完整参数 > 简洁参数 > 单字母参数
