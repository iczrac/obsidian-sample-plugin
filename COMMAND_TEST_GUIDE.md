# 🎮 命令功能测试指南

## 🔍 问题诊断

您提到原来的 `Ctrl+P` 命令不见了，让我们一步步检查和解决这个问题。

## ✅ 当前命令状态

根据代码检查，插件应该注册了以下两个命令：

### 1. **输入时间转八字** 
- **命令ID**: `open-date-picker`
- **功能**: 打开日期选择器，插入八字代码块
- **使用方式**: `Ctrl+P` → 搜索 "输入时间转八字"

### 2. **解析选中的八字**
- **命令ID**: `parse-selected-bazi` 
- **功能**: 将选中的八字文本转换为代码块
- **使用方式**: `Ctrl+P` → 搜索 "解析选中的八字"

## 🧪 测试步骤

### 第一步：检查插件状态
1. 打开 Obsidian 设置 (Ctrl+,)
2. 进入 "社区插件" 页面
3. 确认 "八字命盘" 插件已启用 ✅
4. 如果未启用，请启用插件

### 第二步：检查控制台日志
1. 打开开发者工具 (Ctrl+Shift+I)
2. 查看 Console 标签
3. 重新加载插件或重启 Obsidian
4. 寻找以下日志信息：
   ```
   🚀 八字命盘插件开始加载...
   ⚙️ 设置已加载: {...}
   🎯 开始注册命令...
   📅 注册日期选择命令: open-date-picker
   🔍 注册八字解析命令: parse-selected-bazi
   ✅ 所有命令注册完成
   📋 命令已注册
   ```

### 第三步：测试命令面板
1. 按 `Ctrl+P` 打开命令面板
2. 搜索 "八字" 或 "bazi"
3. 应该看到以下命令：
   - **输入时间转八字**
   - **解析选中的八字**

### 第四步：测试命令功能

#### 测试命令1：输入时间转八字
1. 在编辑器中创建一个新文档
2. 按 `Ctrl+P` 打开命令面板
3. 搜索并选择 "输入时间转八字"
4. 应该弹出日期选择器界面
5. 选择日期和时间，点击确定
6. 应该在光标位置插入八字代码块

#### 测试命令2：解析选中的八字
1. 在编辑器中输入八字文本，例如：`庚午 戊子 乙卯 辛巳`
2. 选中这段文本
3. 按 `Ctrl+P` 打开命令面板
4. 搜索并选择 "解析选中的八字"
5. 应该将选中文本转换为八字代码块

## 🔧 故障排除

### 问题1：命令面板中找不到命令
**可能原因：**
- 插件未正确加载
- 命令注册失败
- Obsidian缓存问题

**解决方案：**
1. 重新启动 Obsidian
2. 禁用并重新启用插件
3. 检查控制台是否有错误信息
4. 确认插件文件完整性

### 问题2：命令存在但无法执行
**可能原因：**
- JavaScript错误
- 依赖模块问题
- 权限问题

**解决方案：**
1. 查看控制台错误日志
2. 重新构建插件：`npm run build`
3. 检查文件权限
4. 清除Obsidian缓存

### 问题3：日期选择器不弹出
**可能原因：**
- 模态框组件问题
- CSS样式冲突
- 其他插件冲突

**解决方案：**
1. 禁用其他插件测试
2. 检查CSS样式是否正确加载
3. 查看控制台错误信息

## 🎯 验证命令正常工作的标志

如果看到以下现象，说明命令功能正常：

### ✅ 成功标志
1. **控制台日志完整** - 看到所有命令注册日志
2. **命令面板显示** - `Ctrl+P` 可以找到两个命令
3. **日期选择器** - "输入时间转八字" 能弹出选择器
4. **代码块插入** - 选择日期后能正确插入代码块
5. **文本转换** - "解析选中的八字" 能转换文本

### ❌ 异常标志
1. **控制台错误** - 有红色错误信息
2. **命令缺失** - 命令面板找不到命令
3. **功能无响应** - 点击命令无反应
4. **界面异常** - 弹出框显示异常

## 🔄 重新安装步骤

如果问题持续存在，可以尝试重新安装：

### 方法1：重新构建
```bash
cd /path/to/bazi-plugin
npm run build
```

### 方法2：完全重新安装
1. 禁用插件
2. 删除插件文件夹
3. 重新复制插件文件
4. 启用插件

### 方法3：开发模式安装
```bash
# 在插件目录中
npm install
npm run dev
```

## 📋 调试检查清单

请按顺序检查以下项目：

- [ ] 插件已启用
- [ ] 控制台无错误
- [ ] 看到命令注册日志
- [ ] 命令面板中能找到命令
- [ ] 点击命令有响应
- [ ] 日期选择器能正常弹出
- [ ] 八字代码块能正确插入

## 🆘 如果仍然有问题

如果按照上述步骤仍然无法解决问题，请提供以下信息：

1. **Obsidian版本**：帮助 → 关于
2. **操作系统**：Windows/Mac/Linux
3. **控制台错误日志**：完整的错误信息
4. **插件列表**：其他已启用的插件
5. **具体现象**：详细描述看到的情况

## 💡 常见解决方案

### 快速修复
1. **重启Obsidian** - 解决大部分缓存问题
2. **重新构建** - `npm run build` 解决代码问题
3. **清除缓存** - 删除 `.obsidian/workspace` 文件

### 深度修复
1. **检查依赖** - `npm install` 重新安装依赖
2. **权限检查** - 确保文件有读写权限
3. **冲突排查** - 禁用其他插件逐一测试

根据我的代码检查，命令注册逻辑是正确的，问题可能出现在插件加载或Obsidian缓存方面。请按照上述步骤进行排查！🔍
