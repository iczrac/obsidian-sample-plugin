# 扩展列标题格式更新测试

## 更新内容

根据用户要求，更新了流月、流日、流时的标题格式，保持大运和流年不变。

### 标题格式对照表

| 扩展类型 | 新标题格式 | 示例 | 状态 |
|----------|------------|------|------|
| 大运 | `大运\n年份范围\n(年龄段)` | `大运\n2024-2034\n(34-44岁)` | ✅ 保持不变 |
| 流年 | `流年\n年份\n(干支)` | `流年\n2024年\n(甲辰)` | ✅ 保持不变 |
| 流月 | `流月\n公历月份\n农历月份` | `流月\n6月\n五月` | 🔄 已更新 |
| 流日 | `流日\n日期\n农历` | `流日\n2024.6.17\n五月十九` | 🔄 已更新 |
| 流时 | `流时\n时间` | `流时\n14:00` | 🔄 已更新 |

## 技术实现

### 1. 流月标题格式
```typescript
// 计算农历月份对应的公历月份
const solarMonth = this.getSolarMonthForLunarMonth(liuYue.year, liuYue.month);
const lunarMonthName = this.getLunarMonthName(liuYue.month);

if (solarMonth && lunarMonthName) {
  displayName = `流月\n${solarMonth}月\n${lunarMonthName}`;
}
```

### 2. 流日标题格式
```typescript
// 格式化日期显示和农历日期
const dateStr = `${dateInfo.year}.${dateInfo.month}.${dateInfo.day}`;
const lunarDate = this.getLunarDateString(dateInfo.year, dateInfo.month, dateInfo.day);

if (lunarDate) {
  displayName = `流日\n${dateStr}\n${lunarDate}`;
}
```

### 3. 流时标题格式
```typescript
// 格式化时间显示（只显示小时）
if (timeInfo.hour !== undefined) {
  const timeStr = `${timeInfo.hour}:00`;
  displayName = `流时\n${timeStr}`;
}
```

## 新增辅助方法

### 1. 公历月份计算
- `getSolarMonthForLunarMonth()`: 计算农历月份对应的公历月份
- 使用月中旬（15日）作为参考点，更准确

### 2. 农历名称转换
- `getLunarMonthName()`: 农历月份名称（正月、二月...冬月、腊月）
- `getLunarDayName()`: 农历日期名称（初一、初二...廿九、三十）

### 3. 农历日期字符串
- `getLunarDateString()`: 完整的农历日期字符串
- 格式：月份名称 + 日期名称（如：五月十九）

## 测试用例

### 测试1：当前时间扩展（验证所有格式）
```bazi
date: 1990-01-01 08:00
gender: 男
e: 1
```

**预期标题格式：**
- 大运：`大运\n2024-2034\n(34-44岁)`
- 流年：`流年\n2024年\n(甲辰)`
- 流月：`流月\n6月\n五月`
- 流日：`流日\n2024.6.17\n五月十九`
- 流时：`流时\n14:00`

### 测试2：流月扩展（重点验证流月格式）
```bazi
date: 1990-01-01 08:00
gender: 男
e: 3
```

**预期标题格式：**
- 大运：`大运\n2024-2034\n(34-44岁)`
- 流年：`流年\n2024年\n(甲辰)`
- 流月：`流月\n6月\n五月`

### 测试3：自定义时间（验证不同时间的格式）
```bazi
date: 1990-01-01 08:00
gender: 男
e: 5
t: 2025-01-15 09:30
```

**预期标题格式：**
- 大运：`大运\n2025-2035\n(35-45岁)`
- 流年：`流年\n2025年\n(乙巳)`
- 流月：`流月\n1月\n腊月`
- 流日：`流日\n2025.1.15\n腊月十六`
- 流时：`流时\n9:00`

### 测试4：不同季节的农历对应
```bazi
date: 1985-03-15 16:45
gender: 女
e: 1
```

**验证要点：**
- 春季农历月份名称是否正确
- 公历与农历月份对应关系
- 农历日期名称格式

## 验证要点

### 1. 格式正确性
- [ ] 流月显示：公历月份 + 农历月份名称
- [ ] 流日显示：完整日期 + 农历日期
- [ ] 流时显示：简洁的时间格式
- [ ] 大运流年保持原格式不变

### 2. 农历转换准确性
- [ ] 农历月份名称正确（正月、二月...冬月、腊月）
- [ ] 农历日期名称正确（初一、初二...廿九、三十）
- [ ] 公历农历对应关系准确

### 3. 显示效果
- [ ] 多行文本正确换行
- [ ] 字体大小适中
- [ ] 关闭按钮位置正确
- [ ] 整体布局美观

### 4. 边界情况
- [ ] 月末月初的农历对应
- [ ] 闰月的处理
- [ ] 不同年份的农历计算

## 可能的问题

1. **农历计算精度**：lunar-typescript库的计算是否准确
2. **月份对应**：公历农历月份对应关系是否合理
3. **显示长度**：农历名称较长时的显示效果
4. **性能影响**：增加农历计算是否影响性能

如果发现任何问题，请检查控制台输出和农历计算的准确性。
